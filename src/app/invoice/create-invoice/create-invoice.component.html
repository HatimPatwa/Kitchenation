<div class="main-section">
    <form [formGroup]="invoiceForm" (ngSubmit)="saveInvoice()">
        <div class="form-section">
            <div class="form-header">
                <h2 class="kt-heading mb-4">Enter Customer and Invoice Information</h2>
            </div>
            <div class="form-body ">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="text" formControlName="customerName" class="form-control" id="cust_name"
                                placeholder="customer name here"
                                [class.is-invalid]="invoiceForm.get('customerName')?.invalid && submitted">
                            <label for="cust_name">Customer Name</label>
                            <div class="invalid-feedback">
                                <ng-container *ngIf="invoiceForm.get('customerName')?.errors?.['required']">
                                    <span>Customer Name is required!</span>
                                </ng-container>

                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="email" formControlName="customerEmail" class="form-control" id="cust_email"
                                placeholder="name@example.com"
                                [class.is-invalid]="invoiceForm.get('customerEmail')?.invalid && submitted">
                            <label for="cust_email">Email address</label>
                            <div class="invalid-feedback">
                                <ng-container *ngIf="invoiceForm.get('customerEmail')?.errors?.['required']">
                                    <span>Email is required!</span>
                                </ng-container>
                                <ng-container *ngIf="invoiceForm.get('customerEmail')?.errors?.['email']">
                                    <span>Email entered is invalid</span>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="text" formControlName="invoiceNumber" class="form-control" id="inv_number"
                                placeholder="invoice number here">
                            <label for="inv_number">Invoice no.</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <div class="form-floating mb-3">
                            <input type="email" formControlName="customerAddress" class="form-control" id="cust_addr"
                                placeholder="name@example.com">
                            <label for="cust_addr">Customer's address</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="date" formControlName="invoiceDate" class="form-control" id="inv_date"
                                placeholder="invoice number here">
                            <label for="inv_date">Invoice date.</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-floating mb-3">

                            <select formControlName="customerCountry" (change)="getStates()"
                                class="form-select form-select-lg mb-3 pb-0 pt-3" aria-label=".form-select-lg">
                                <!-- <option selected>Select Country</option> -->
                                <option *ngFor="let obj of countries" [value]="obj.country">{{obj.country}}
                                </option>
                            </select>
                            <label>Country</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <select formControlName="customerState" id="cust_state"
                                class="form-select form-select-lg mb-3 pb-0 pt-3" aria-label=".form-select-lg">
                                <!-- <option selected>Select Country</option> -->
                                <option *ngFor="let state of states" [value]="state">{{state}}
                                </option>

                            </select>
                            <label for="cust_state">State</label>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="cust_city" placeholder="customer city">
                            <label for="cust_city">City</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="cust_zip" placeholder="zip code here">
                            <label for="cust_zip">Zip/Postal Code</label>
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="text" formControlName="customerPhone" class="form-control" id="cust_phone"
                                placeholder="customer phone here">
                            <label for="cust_phone">Customer phone</label>
                        </div>
                    </div>
                    <!-- <div class="col-md-4">
                        <div class="form-floating mb-3">
                            <input type="email" formControlName="customerEmail" class="form-control"
                                placeholder="name@example.com">
                            <label>Email address</label>
                        </div>
                    </div> -->
                </div>

            </div>
        </div>
        <div class="form-section my-2">
            <div class="form-header">
                <h2 class="kt-heading mb-4">Enter product details</h2>
            </div>
            <div class="form-body" formArrayName="products">

                <ng-container *ngFor="let product of products.controls; let i = index" [formGroupName]="i">

                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-floating mb-3">
                                <p-autoComplete styleClass="autocomplete-field" formControlName="itemDetails"
                                    [showEmptyMessage]="true" [suggestions]="filteredInventory"
                                    (completeMethod)="filterInventory($event)" field="item"
                                    (onSelect)="onSelectInventory($event,i)" [minLength]="2"
                                    placeholder="Item name"></p-autoComplete>
                                <!-- <input type="text" formControlName="name" class="form-control"
                                    placeholder="customer name here"> -->
                                <!-- <label>Item</label> -->
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-floating mb-3">
                                <input type="text" formControlName="description" class="form-control" placeholder="description">
                                <label>Description</label>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="form-floating mb-3">
                                <input type="number" formControlName="quantity" (input)="calculateItemAmount(i)"
                                    step="1" class="form-control" placeholder="invoice number here">
                                <label>Quantity</label>
                            </div>
                        </div>
                        <div class="col-md-2">

                            <fieldset [disabled]="true">
                                <div class="form-floating mb-3">
                                    <input type="number" step=".25" (input)="calculateItemAmount(i)"
                                        formControlName="rate" class="form-control" placeholder="invoice number here">
                                    <label>Rate</label>
                                </div>
                            </fieldset>

                        </div>
                        <div class="col-md-2">
                            <div class="mb-3">
                                <span *ngIf="i===0" class="item-amount">Amount</span>
                                <h4 class="amount-value" [ngClass]="{'mt-3': i!==0}">&#8377;
                                    {{products.at(i).get('netAmount')?.value}}
                                </h4>
                            </div>
                        </div>
                        <div class="col-md-1  item-amount-col">
                            <div class="form-floating">
                                <button *ngIf="i!==0" class="btn btn-danger btn-circle" (click)="removeProduct(i)"><i
                                        class="fa fa-xmark "></i></button>
                            </div>
                        </div>

                    </div>

                </ng-container>

                <div class="line-item_add">
                    <button type="button" class="" (click)="addProduct()">
                        <i class="fa fa-plus"></i>
                        <span class="mx-2">Add item to list</span>
                    </button>

                </div>

            </div>
        </div>
        <div class="form-section">

            <div class="form-body">
                <div class="row">

                    <div class="col-md-5">
                        <div class="form-floating">
                            <textarea class="form-control" formControlName="terms" placeholder="Leave a comment here"
                                id="inv_terms" style="height: 100px"></textarea>
                            <label for="inv_terms">Terms</label>
                        </div>
                    </div>
                    <div class="col-md-4">

                        <div class="total-wrap">
                            <div class="subtotal-wrap">
                                <span class="subtotal-label">Total</span>
                                <h4 class="subtotal-value">&#8377; {{invoiceForm.get('netTotal')?.value}}</h4>
                            </div>
                        </div>

                        <button type="submit" (click)="submitted = true" class="btn btn-primary">Save Invoice</button>
                    </div>

                </div>

            </div>

        </div>


    </form>
</div>